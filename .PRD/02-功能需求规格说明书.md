# 收益分配测算系统 - 功能需求规格说明书

## 1. 功能概述

本文档详细描述收益分配测算系统的功能需求，包括参数输入、计算处理、结果展示等核心功能模块的具体实现要求。

## 2. 参数输入模块

### 2.1 基本参数输入功能

#### 功能描述
提供投资项目基本参数的输入界面，包括投资标的、金额、期限等关键信息。

#### 功能实现流程
1. 用户进入参数输入页面
2. 系统展示基本参数输入表单
3. 用户填写各项参数
4. 系统实时验证输入数据的有效性
5. 验证通过后，参数保存到会话存储

#### 业务规则
- 投资标的：必填，文本长度1-100字符
- 拟投资金额：必填，数值范围1-999999万元，支持小数点后2位
- 投资期限：必填，整数范围1-30年
- 门槛收益率：必填，百分比范围0-100%，支持小数点后2位
- 管理人Carry：必填，百分比范围0-100%，支持小数点后2位

#### 使用角色
- 投资经理
- 风控人员
- 财务分析师

#### 界面设计要求
- 采用卡片式布局，清晰分组显示
- 必填项标注红色星号
- 实时显示输入验证结果
- 提供输入提示和帮助信息

### 2.2 净现金流输入功能

#### 功能描述
根据投资期限动态生成现金流输入表格，支持手工输入和Excel文件导入。

#### 功能实现流程
1. 系统根据投资期限生成对应年份的输入表格
2. 用户可选择手工输入或文件导入
3. 手工输入：逐年填写净现金流数据
4. 文件导入：上传Excel文件，系统自动解析数据
5. 系统验证数据完整性和有效性
6. 提供数据预览和修改功能

#### 业务规则
- 现金流数据按年度组织，从第1年到第N年
- 现金流金额支持正负数，精度到万元，小数点后2位
- Excel文件格式要求：.xlsx或.xls，大小不超过10MB
- 导入文件必须包含完整的基本参数和现金流数据
- 数据导入后允许手工修改

#### 使用角色
- 投资经理
- 财务分析师
- 数据录入员

#### 界面设计要求
- 表格形式展示，年份为行，现金流为列
- 支持批量复制粘贴功能
- 提供Excel模板下载
- 文件拖拽上传支持
- 数据验证错误高亮显示

### 2.3 分配模式参数设置功能

#### 功能描述
提供多种收益分配模式的参数配置界面，支持平层结构和结构化两大类分配方式。

#### 功能实现流程
1. 用户选择分配模式（平层结构/结构化）
2. 系统根据选择展示对应的分配方式选项
3. 用户选择具体分配方式
4. 系统动态显示该方式所需的参数输入项
5. 用户填写相关参数
6. 系统验证参数的合理性和一致性

#### 业务规则

##### 平层结构模式
**分配方式1.1（优先还本）**
- 无额外参数需求
- 分配顺序：还本 → 门槛收益 → Carry分配

**分配方式1.2（期间分配）**
- 期间收益率：必填，百分比范围0-100%，不能超过门槛收益率
- 分配顺序：期间收益 → 还本 → 剩余门槛收益 → Carry分配

##### 结构化模式
**分配方式2.1（优先劣后）**
- 优先级比例：必填，百分比范围1-99%
- 劣后比例：自动计算，= 100% - 优先级比例
- 优先级收益率：引用门槛收益率，不可修改
- 分配顺序：优先级还本 → 优先级门槛收益 → 劣后还本 → 劣后门槛收益 → Carry分配

**分配方式2.2（包含夹层）**
- 优先级比例：必填，百分比范围1-97%
- 夹层比例：必填，百分比范围1-97%
- 劣后比例：自动计算，= 100% - 优先级比例 - 夹层比例
- 优先级收益率：引用门槛收益率，不可修改
- 夹层收益率：必填，百分比范围0-100%
- 三者比例之和必须等于100%
- 分配顺序：优先级还本 → 优先级门槛收益 → 夹层还本 → 夹层门槛收益 → 劣后还本 → 劣后门槛收益 → Carry分配

**分配方式2.3（息息本本）**
- 优先级比例：必填，百分比范围1-99%
- 劣后比例：自动计算，= 100% - 优先级比例
- 优先级收益率：引用门槛收益率，不可修改
- 劣后级收益率：必填，百分比范围0-100%
- 分配顺序：优先级期间收益 → 劣后期间收益 → 优先级还本 → 劣后还本 → Carry分配

#### 使用角色
- 投资经理
- 产品设计师
- 风控人员

#### 界面设计要求
- 分步骤引导式界面设计
- 参数联动计算和实时显示
- 提供分配逻辑说明和示例
- 参数冲突时给出明确提示

## 3. 计算引擎模块

### 3.1 核心计算功能

#### 功能描述
基于输入参数和现金流数据，按照选定的分配模式执行收益分配计算。

#### 功能实现流程
1. 接收前端传递的计算参数
2. 验证参数完整性和有效性
3. 根据分配模式调用对应的计算算法
4. 逐期计算现金流分配结果
5. 计算IRR、DPI等核心指标
6. 返回完整的计算结果

#### 业务规则

##### 通用计算规则
- 所有金额计算精确到万元，保留2位小数
- 百分比计算精确到0.01%
- IRR计算采用牛顿迭代法，精度0.0001%
- DPI = 累计分配金额 / 初始投资金额

##### 平层结构计算规则
**优先还本模式**
```
每期计算顺序：
1. 期初本金余额 = 上期期末本金余额
2. 摊还本金 = min(当期净现金流, 期初本金余额)
3. 计提门槛收益 = 期初本金余额 × 门槛收益率
4. 剩余现金流 = 当期净现金流 - 摊还本金
5. 分配门槛收益 = min(剩余现金流, 累计未分配门槛收益)
6. Carry分配 = 剩余现金流 - 分配门槛收益
7. CarryLP = Carry分配 × (1 - 管理人Carry比例)
8. CarryGP = Carry分配 × 管理人Carry比例
```

**期间分配模式**
```
每期计算顺序：
1. 期初本金余额 = 上期期末本金余额
2. 期间收益 = 期初本金余额 × 期间收益率
3. 摊还本金 = min(当期净现金流 - 期间收益, 期初本金余额)
4. 计提门槛收益 = 期初本金余额 × (门槛收益率 - 期间收益率)
5. 剩余现金流 = 当期净现金流 - 期间收益 - 摊还本金
6. 分配门槛收益 = min(剩余现金流, 累计未分配门槛收益)
7. Carry分配 = 剩余现金流 - 分配门槛收益
```

##### 结构化计算规则
**优先劣后模式**
```
每期计算顺序：
1. 优先级期间收益 = 优先级期初本金余额 × 优先级收益率
2. 优先级摊还本金 = min(剩余现金流, 优先级期初本金余额)
3. 劣后摊还本金 = min(剩余现金流, 劣后期初本金余额)
4. Carry分配按平层结构规则计算
```

#### 使用角色
- 系统内部调用
- 开发人员（调试）

#### 界面设计要求
- 计算过程中显示进度条
- 计算错误时提供详细错误信息
- 支持计算结果的缓存机制

### 3.2 数据验证功能

#### 功能描述
对输入数据进行全面验证，确保计算的准确性和系统的稳定性。

#### 功能实现流程
1. 接收输入数据
2. 执行格式验证
3. 执行业务逻辑验证
4. 执行数据一致性验证
5. 返回验证结果和错误信息

#### 业务规则
- 数值范围验证
- 必填项完整性验证
- 百分比总和验证（结构化模式）
- 现金流数据合理性验证
- 参数间逻辑关系验证

## 4. 结果展示模块

### 4.1 测算结论展示功能

#### 功能描述
展示投资收益的核心指标，包括IRR、DPI等关键结论。

#### 功能实现流程
1. 接收计算引擎返回的结果
2. 格式化数据展示
3. 生成结论摘要
4. 提供详细数据查看

#### 业务规则
- IRR以百分比形式显示，保留2位小数
- DPI以倍数形式显示，保留2位小数
- 提供计算假设和前提条件说明

#### 界面设计要求
- 核心指标突出显示
- 提供指标解释和计算说明
- 支持不同分配方式结果对比

### 4.2 现金流分配表格功能

#### 功能描述
以表格形式详细展示每期的现金流分配情况。

#### 功能实现流程
1. 根据分配模式确定表格列结构
2. 填充计算结果数据
3. 格式化数值显示
4. 提供表格交互功能

#### 业务规则
- 表格行：第0年到第N年
- 表格列：根据分配方式动态调整
- 数值格式：万元，保留2位小数
- 百分比格式：保留2位小数

#### 界面设计要求
- 响应式表格设计
- 支持排序和筛选
- 关键数据高亮显示
- 提供表格导出功能

### 4.3 数据导出功能

#### 功能描述
支持将计算结果导出为Excel文件，便于后续分析和报告。

#### 功能实现流程
1. 用户点击导出按钮
2. 系统生成Excel文件
3. 包含所有输入参数和计算结果
4. 自动下载到用户本地

#### 业务规则
- 文件格式：.xlsx
- 包含多个工作表：参数、现金流、结果
- 保持数据格式和公式
- 文件命名：项目名称_日期时间

#### 界面设计要求
- 一键导出功能
- 导出进度提示
- 支持自定义导出内容

## 5. 可视化展示模块

### 5.1 图表展示功能

#### 功能描述
通过多种图表形式展示现金流分配和收益情况。

#### 功能实现流程
1. 分析计算结果数据
2. 选择合适的图表类型
3. 生成交互式图表
4. 提供图表配置选项

#### 业务规则
- 现金流趋势图：折线图
- 分配结构图：堆叠柱状图
- 收益分布图：饼图
- 本金回收图：面积图

#### 界面设计要求
- 图表交互功能
- 数据标签显示
- 图例说明
- 图表导出功能

### 5.2 对比分析功能

#### 功能描述
支持不同分配方式的结果对比分析。

#### 功能实现流程
1. 用户选择对比方案
2. 系统并行计算多种方案
3. 生成对比图表和表格
4. 提供差异分析报告

#### 业务规则
- 最多支持3种方案对比
- 对比维度：IRR、DPI、现金流分配
- 差异分析：绝对差异和相对差异

#### 界面设计要求
- 并排对比展示
- 差异高亮显示
- 对比结论总结

## 6. 系统管理模块

### 6.1 会话管理功能

#### 功能描述
管理用户会话数据，确保数据安全和系统性能。

#### 功能实现流程
1. 用户访问系统时创建会话
2. 会话数据存储在Redis中
3. 设置会话超时时间
4. 会话结束时自动清理数据

#### 业务规则
- 会话超时时间：2小时
- 数据自动清理机制
- 不保存敏感信息

### 6.2 错误处理功能

#### 功能描述
统一的错误处理和用户友好的错误提示。

#### 功能实现流程
1. 捕获系统异常
2. 记录错误日志
3. 返回用户友好的错误信息
4. 提供错误恢复建议

#### 业务规则
- 错误分类：输入错误、计算错误、系统错误
- 错误日志记录但不包含敏感数据
- 提供错误代码和解决方案

## 7. 性能要求

### 7.1 响应时间要求
- 页面加载时间：< 3秒
- 计算响应时间：< 5秒
- 文件上传处理：< 10秒
- 数据导出时间：< 15秒

### 7.2 并发性能要求
- 支持并发用户数：50
- 系统可用性：99.5%
- 数据准确性：100%

### 7.3 资源使用要求
- 内存使用：< 2GB
- CPU使用率：< 80%
- 磁盘空间：< 10GB
- 网络带宽：< 100Mbps