# 收益分配测算系统

## 背景

- 这是一个提高金融测算效率的工具，无论何种资产，在投资收益测算中如果已得到未来净现金流预测，能够快速得到投资收益的结果（请优化补充）。

## 目标

- 基于某资产未来一段期限的净现金流，按照不同的分配顺序逻辑，计算现金流分配、剩余本金、现金流分派率、投资收益等，并通过表格及可视化网页呈现，并提供下载功能。

## 功能需求

### 输入部分

- 第一部分为基本参数输入
    - 投资标的（文本输入）
    - 拟投资金额（万元）
    - 投资期限（年）
    - 门槛收益率（%）
    - 管理人Carry（%）
- 第二部分为净现金流输入
    - 根据基本参数中的投资年限，提供对应年限的输入窗口
    - 可上传excl文件，包括第一部分基本参数，和每年净现金流参数，由系统提取
    - 提取后保留输入窗口的修改功能
- 第三部分为模式参数输入
    - 模式选择
        - 模式1：平层结构
            - 分配方式1.1（优先还本）
                - 分配顺序
                  - 净现金流优先还本，并按期初本金余额计提门槛收益
                      - #以下为计算逻辑，不用展现在选项中
                      - #首年期初本金余额=投资金额
                      - #首年摊还本金=首年净现金流
                      - #第N年期初本金余额=第N-1年期初本金余额-第N-1年摊还本金
                      - #第N-1年摊还本金=#第N-1年净现金流
                  - 本金还完当期，开始分配已计提的门槛收益
                      - #以下为计算逻辑，不用展现在选项中
                      - #计提门槛收益=当期期初本金余额*门槛收益率
                  - 门槛收益还完当期，剩余净现金流开始分配Carry
                      - #以下为计算逻辑，不用展现在选项中
                      - #CarryLp=当期剩余净现金流*（1-管理人Carry）
                      - #CarryGp=当期剩余净现金流*管理人Carry
                  - 持续分配Carry直至投资期限结束
            - 分配方式1.2（期间分配）
                - 该模式下提供额外的参数输入
                    - 期间收益率（%）
                - 分配顺序
                  - 净现金流优先按照期初本金余额，分配期间收益
                      - #以下为计算逻辑，不用展现在选项中
                      - #期间收益=期初本金余额*期间收益率
                  - 分配期间收益后，剩余现金流归还本金，并按期初本金余额计提门槛收益，但当期不分配
                      - #以下为计算逻辑，不用展现在选项中
                      - #首年期初本金余额=投资金额
                      - #首年摊还本金=首年净现金流-首年期间收益
                      - #第N年期初本金余额=第N-1年期初本金余额-第N-1年摊还本金
                      - #第N-1年期摊还本金=第N-1年期净现金流-第N-1年期间收益
                  - 本金还完当期，开始分配已计提的剩余门槛收益
                      - #以下为计算逻辑，不用展现在选项中
                      - #计提门槛收益=当期期初本金余额*（门槛收益率-期间收益率）
                  - 门槛收益还完当期，剩余净现金流开始分配Carry
                      - #以下为计算逻辑，不用展现在选项中
                      - #CarryLp=当期剩余净现金流*（1-管理人Carry）
                      - #CarryGp=当期剩余净现金流*管理人Carry
                  - 持续分配Carry直至投资期限结束
        - 模式2：结构化
            - 分配方式2.1（优先劣后）
                - 该模式下提供额外的参数输入
                    - 优先级比例（%）
                      - 输入比例后输出对应优先级金额
                    - 劣后比例（%）
                      - 输入比例后输出对应劣后级金额
                - 分配顺序
                    - 当期净现金流优先按期初优先级剩余本金*优级收益率分配给优先级
                    - 剩余净现金流偿还优先级本金
                    - 按上述分配顺序，优先级首先实现本息退出
                    - 优先级退出当期剩余净现金流开始偿还劣后本金
                    - 直至劣后本金实现退出，当期剩余净现金流开始分配Carry
                      - #以下为Carry计算逻辑，不用展现在选项中
                      - #CarryLp=当期剩余净现金流*（1-管理人Carry）
                      - #CarryGp=当期剩余净现金流*管理人Carry
                      - 持续分配Carry直至投资期限结束
              - 分配方式2.2（包含夹层）
                - 该模式下提供额外的参数输入
                    - 优先级比例（%）
                      - 输入比例后输出对应优先级金额
                    - 优先级收益率（%）
                      - 引用第一部分为基本参数输入中门槛收益的值，不可在此处调整
                    - 夹层比例（%）
                      - 输入比例后输出对应夹层金额
                    - 夹层收益率（%）
                      - 输入夹层收益率参数
                    - 劣后比例（%）
                      - 输入比例后输出对应劣后级金额
                - 分配顺序
                  - 当期净现金流优先按期初优先级剩余本金*优级收益率分配给优先级
                  - 剩余净现金流按照期初夹层剩余本金*夹层收益率分配给夹层
                  - 如有剩余，当期剩余净现金流偿还优先级本金
                  - 按上述分配顺序，优先级首先实现本息退出
                  - 优先级退出当期剩余净现金流在分配夹层当期收益后，开始偿还夹层本金
                  - 直至夹层实现本息退出，当期剩余净现金流开始偿还劣后本金
                  - 直至劣后本金实现退出，当期剩余净现金流开始分配Carry
                    - #以下为Carry计算逻辑，不用展现在选项中
                    - #CarryLp=当期剩余净现金流*（1-管理人Carry）
                    - #CarryGp=当期剩余净现金流*管理人Carry
                    - 持续分配Carry直至投资期限结束
            - 分配方式2.3（息息本本）
                - 该模式下提供额外的参数输入
                  - 优先级比例（%）
                    - 输入比例后输出对应优先级金额
                  - 优先级收益率（%）
                    - 引用第一部分为基本参数输入中门槛收益的值，不可在此处调整
                  - 劣后比例（%）
                    - 输入比例后输出对应劣后级金额
                  - 劣后级收益率（%）
                    - 输入劣后收益率参数
                - 分配顺序
                    - 当期净现金流优先按期初优先级剩余本金*优级收益率分配给优先级
                    - 剩余净现金流按照期劣后剩余本金*劣后收益率分配给劣后
                    - 如有剩余，当期剩余净现金流偿还优先级本金
                    - 按上述分配顺序，优先级首先实现本息退出
                    - 优先级退出当期剩余净现金流在分配劣后当期收益后，开始偿还劣后本金
                    - 直至劣后本金实现退出，当期剩余净现金流开始分配Carry
                      - #以下为Carry计算逻辑，不用展现在选项中
                      - #CarryLp=当期剩余净现金流*（1-管理人Carry）
                      - #CarryGp=当期剩余净现金流*管理人Carry
                      - 持续分配Carry直至投资期限结束 

### 测算结论输出部分
- 核心结论
  - IRR：根据初始投资金额和投资期限内的净现金流计算IRR
  - DPI：根据初始投资金额和投资期限内的净现金流计算DPI
- 现金流展示
  - 展示一张表格，行为：第0年-第N年（投资年限）
  - 列分为两部分
    - 第一部分：现金流概况
      - 净现金流
      - 现金流分派率
        - 现金流分派率=当期净现金流/投资金额
    - 第二部分：现金流分配
      - 根据不同分配方式，展示不同列内容
        - 分配方式1.1
          - 期初本金余额
          - 摊还本金
          - 计提门槛收益
          - 分配门槛收益
          - CarryLP
          - CarryGP
        - 分配方式1.2
          - 期初本金余额
          - 期间分配收益
          - 计提门槛收益
          - 摊还本金
          - 分配门槛收益
          - CarryLP
          - CarryGP
        - 分配方式2.1
          - 优先期初本金余额
          - 优先期间分配收益
          - 优先摊还本金
          - 劣后本金余额
          - 劣后摊还本金
          - CarryLP
          - CarryGP
        - 分配方式2.2
          - 优先期初本金余额
          - 优先期间分配收益
          - 优先摊还本金
          - 夹层期初本金余额
          - 夹层期间分配收益
          - 夹层摊还本金
          - 劣后本金余额
          - 劣后摊还本金
          - CarryLP
          - CarryGP
        - 分配方式2.3
          - 优先期初本金余额
          - 优先期间分配收益
          - 优先摊还本金
          - 劣后期初本金余额
          - 劣后期间分配收益
          - 劣后摊还本金
          - CarryLP
          - CarryGP
- 提供导出xlsx文件的功能和按钮

### 可视化输出部分
- 提供上述不同方案测算结论的可视化输出
- 通过不同维度展示现金流回收情况
- 其他请补充

## 非功能需求

### 样式

- 采用现代简约风格
- 网页应对不同模块提供单独的选项卡
- 其他请补充

### 开发框架

- 前端展示模块为html+css+js
- 后端计算模块为python
- 其他请补充

### 安全性

- 数据不提供存储功能，确保所有计算清空后不留痕
- 确保数据导入并计算的过程安全
- 其他请补充

# 输出要求

- 这是一份初始需求文档，请在保留核心需求的情况下，提供完整的需求文档，同时在该文件中详细说明开发框架和开发语言、数据库选择等
- 你可以在保留核心需求的情况下，重新构建需求文档的逻辑，使其更符合开发的结构，以便于后续更新维护
- 你应该从专业的开发工程师角度，为每一个必要的部分输出独立的md需求文档，并进行合理命名
- 需求文档子标题要包括功能描述，功能实现流程，业务规则，使用角色，界面设计要求等关键内容
- 需要有一个独立的 UI/UE界面风格设计约束和规约md文件，所有功能实现都需要参考这个文件
- 需要有一个数据库设计md文件，详细说明数据库设计需求
- 现在请基于输出要求帮我生成md设计文件到PRD目录下面
- 如果你对处理这项工作有任何问题，请向我提出