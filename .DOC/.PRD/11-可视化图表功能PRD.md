# 可视化图表功能产品需求文档（PRD）

## 文档信息
- **文档名称**: 可视化图表功能产品需求文档
- **版本号**: v1.1.0
- **创建日期**: 2024-12-19
- **最后更新**: 2024-12-19
- **文档状态**: 待开发
- **负责人**: 产品经理

---

## 1. 项目背景

### 1.1 需求来源
基于收益分配测算系统v2.6.0稳定版本的基础功能，为了提升用户体验和数据可读性，需要增加可视化图表功能。投资人需要通过直观的图表来理解复杂的收益分配计算结果。

### 1.2 业务价值
- **提升用户体验**: 通过可视化图表替代纯数字表格，提高数据可读性
- **增强专业性**: 为投资人提供专业级的数据分析图表
- **支持决策**: 帮助投资人更好地理解现金流分配逻辑和回收情况
- **提高效率**: 减少投资人数据解读时间，提高工作效率

### 1.3 目标用户
- **主要用户**: 投资机构、基金管理人、财务分析师
- **次要用户**: 律师事务所、会计师事务所等专业服务机构
- **使用场景**: 投资决策分析、LP汇报、尽职调查等

---

## 2. 产品概述

### 2.1 产品定位
作为收益分配测算系统的增强功能模块，提供多维度的可视化图表分析，帮助投资人从不同角度理解投资收益分配情况。

### 2.2 核心价值主张
- **多维度分析**: 从投资人关心的核心问题出发，提供多角度数据分析
- **专业图表**: 提供符合金融行业标准的专业图表展示
- **直观易懂**: 将复杂的分配逻辑通过图表直观展示
- **风格统一**: 保持与系统整体设计风格的一致性

---

## 3. 需求分析

### 3.1 用户需求分析

#### 3.1.1 投资人关心的核心问题
1. **现金流回收情况**
   - 各年度现金流入流出情况
   - 累计回收进度
   - 回本周期可视化

2. **收益分配结构**
   - 每期现金流如何分配
   - 各层级收益占比
   - 分配优先级展示

3. **投资表现评估**
   - IRR/DPI等核心指标趋势
   - 与基准收益率对比
   - 风险收益分析

#### 3.1.2 功能需求优先级
- **P0（必须有）**: 核心指标展示、分配情况概览、现金流回收图、现金流分配图
- **P1（应该有）**: 分配结构饼图、核心指标趋势图
- **P2（可以有）**: 对比分析图、风险分析图

### 3.2 技术需求分析

#### 3.2.1 图表库选择
- **推荐方案**: Chart.js（轻量级、响应式、易集成）
- **备选方案**: ECharts（功能强大、中文支持好）
- **评估标准**: 文件大小、渲染性能、定制能力、移动端适配

#### 3.2.2 数据处理需求
- 现有计算结果数据格式化
- 图表数据结构转换
- 动态数据更新机制

---

## 4. 功能设计

### 4.1 核心功能清单

#### 4.1.1 核心指标仪表盘（8个指标卡片）
- **内部收益率(IRR)**: 投资项目的内部收益率
- **分配倍数(DPI)**: 累计分配金额与投资金额的比值
- **分派率**: 各年度分派率的范围（最小值-最大值）
- **静态回本周期**: 不考虑资金时间价值的回本期
- **计算模式**: 当前使用的分配计算模式
- **投资金额**: 项目总投资金额
- **投资期限**: 项目投资期限
- **门槛收益率**: 投资人最低预期收益率

#### 4.1.2 分配情况概览
- **分配顺序展示**: 根据不同计算模式展示分配优先级
- **分配比例**: 各类型分配在总分配中的占比
- **对应金额**: 每种分配类型的具体金额
- **动态适配**: 根据用户选择的计算模式动态调整显示内容

#### 4.1.3 现金流回收图
- **图表类型**: 瀑布图/柱状图组合
- **横轴**: 年限（1-N年）
- **纵轴**: 现金流量（万元）
- **数据展示**:
  - 向下（负值）: 初始投资流出
  - 向上（正值）: 各年度现金流入
  - 累计线: 显示累计回收进度
- **交互功能**:
  - 悬停显示详细数值
  - 点击年份查看分配明细
  - 缩放和平移支持

#### 4.1.4 现金流分配图
- **图表类型**: 堆叠柱状图
- **横轴**: 年限（1-N年）
- **纵轴**: 分配比例（0-100%）
- **数据展示**:
  - 不同颜色代表不同分配类型
  - 百分比堆叠显示分配结构
  - 图例说明各分配类型
- **分配类型**:
  - 本金归还
  - 门槛收益/期间收益
  - Carry分配（LP/GP）
  - 根据计算模式动态调整

#### 4.1.5 分配结构饼图
- **整体分配**: 总投资回收结构
- **分层展示**: 可展开查看各层级详情
- **动画效果**: 扇形动画和数据标签

#### 4.1.6 趋势分析图
- **核心指标趋势**: IRR/DPI等指标的时间趋势
- **多指标对比**: 支持多个指标同时展示
- **基准对比**: 与目标值进行对比分析

### 4.2 界面布局设计

#### 4.2.1 图表区域规划
```
┌─────────────────────────────────────────────────────────┐
│                    核心指标仪表盘                        │
│  ┌────────┐┌────────┐┌────────┐┌────────┐              │
│  │  IRR   ││  DPI   ││ 分派率  ││ 回本期  │              │
│  └────────┘└────────┘└────────┘└────────┘              │
│  ┌────────┐┌────────┐┌────────┐┌────────┐              │
│  │计算模式││投资金额││投资期限││门槛率  │              │
│  └────────┘└────────┘└────────┘└────────┘              │
├─────────────────────────────────────────────────────────┤
│                    分配情况概览                          │
│  分配顺序：本金归还 → 门槛收益 → Carry分配               │
│  ┌─────────────┐┌─────────────┐┌─────────────┐        │
│  │ 本金归还 65% ││ 门槛收益 25%││ Carry 10%   │        │
│  │  1,000万元  ││   680万元   ││   170万元    │        │
│  └─────────────┘└─────────────┘└─────────────┘        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────┐ ┌─────────────────────────┐    │
│  │                     │ │                         │    │
│  │    现金流回收图      │ │     现金流分配图         │    │
│  │                     │ │                         │    │
│  └─────────────────────┘ └─────────────────────────┘    │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐ ┌─────────────────────────┐    │
│  │                     │ │                         │    │
│  │   分配结构饼图       │ │     趋势分析图           │    │
│  │                     │ │                         │    │
│  └─────────────────────┘ └─────────────────────────┘    │
└─────────────────────────────────────────────────────────┘
```

#### 4.2.2 响应式设计
- **桌面端**: 4x2指标网格 + 2x2图表布局
- **平板端**: 2x4指标网格 + 2x1图表布局，可滚动
- **移动端**: 1x8指标列表 + 1x1图表布局，卡片式展示

---

## 5. 技术实现方案

### 5.1 前端技术栈
- **图表库**: Chart.js v4.x
- **UI框架**: 基于现有HTML/CSS/JS架构
- **数据处理**: 现有JavaScript函数扩展
- **动画效果**: CSS3 + Chart.js动画

### 5.2 数据流设计

#### 5.2.1 数据源
```javascript
// 计算结果数据结构
{
  calculation_mode: "平层结构-优先还本",
  core_metrics: {
    irr: "15.25%",
    dpi: "1.85",
    static_payback_period: "3.2 年",
    dynamic_payback_period: "3.8 年"
  },
  distribution_summary: {
    order: ["本金归还", "门槛收益", "Carry分配"],
    amounts: {
      principal_repayment: "1,000万元",
      hurdle_return: "680万元", 
      carry_total: "170万元"
    },
    percentages: {
      principal_repayment: "65%",
      hurdle_return: "25%",
      carry_total: "10%"
    }
  },
  basic_params: {
    investment_amount: "1,000万元",
    investment_period: "5年",
    hurdle_rate: "8%"
  },
  cash_flow_table: [
    // ... 详细现金流数据
  ]
}
```

#### 5.2.2 分配情况数据转换
```javascript
// 根据计算模式生成分配情况
function getDistributionSummary(calculationMode, cashFlowTable, totals) {
  const summaries = {
    '平层结构-优先还本': {
      order: ["本金归还", "门槛收益", "Carry分配"],
      fields: ["principal_repayment", "distributed_hurdle_return", "carry_total"]
    },
    '平层结构-期间分配': {
      order: ["期间分配", "本金归还", "剩余门槛收益", "Carry分配"],
      fields: ["periodic_distribution", "principal_repayment", "distributed_hurdle_return", "carry_total"]
    },
    '结构化-优先劣后': {
      order: ["优先级还本", "优先级收益", "劣后级还本", "Carry分配"],
      fields: ["senior_principal_repayment", "senior_periodic_return", "subordinate_principal_repayment", "carry_total"]
    }
    // ... 其他模式
  };
  
  return summaries[calculationMode] || summaries['平层结构-优先还本'];
}
```

### 5.3 API接口设计

#### 5.3.1 图表数据接口
```javascript
// GET /api/chart-data
// 响应格式
{
  success: true,
  data: {
    core_metrics: {
      irr: { value: "15.25%", display: "内部收益率" },
      dpi: { value: "1.85", display: "分配倍数" },
      // ... 8个指标
    },
    distribution_summary: {
      mode: "平层结构-优先还本",
      order: ["本金归还", "门槛收益", "Carry分配"],
      items: [
        { name: "本金归还", amount: "1,000万元", percentage: "65%" },
        { name: "门槛收益", amount: "680万元", percentage: "25%" },
        { name: "Carry分配", amount: "170万元", percentage: "10%" }
      ]
    },
    chart_configs: {
      cash_flow_chart: { /* Chart.js配置 */ },
      distribution_chart: { /* Chart.js配置 */ },
      pie_chart: { /* Chart.js配置 */ },
      trend_chart: { /* Chart.js配置 */ }
    }
  }
}
```

---

## 6. 用户体验设计

### 6.1 交互设计原则
- **渐进式展示**: 先显示核心指标和分配概览，支持钻取查看详情
- **即时反馈**: 鼠标悬停显示数据标签
- **一致性**: 保持与现有系统的交互模式一致
- **可访问性**: 支持键盘导航和屏幕阅读器

### 6.2 视觉设计规范

#### 6.2.1 颜色规范
- **主色调**: 沿用系统现有颜色
  - 主色: #3B82F6 (蓝色)
  - 成功: #10B981 (绿色) 
  - 警告: #F59E0B (橙色)
  - 错误: #EF4444 (红色)
  
- **图表配色方案**:
  - 本金归还: #3B82F6 (蓝色)
  - 门槛收益: #10B981 (绿色)
  - Carry LP: #8B5CF6 (紫色)
  - Carry GP: #F59E0B (橙色)

#### 6.2.2 字体规范
- **标题字体**: 16px, bold, #1F2937
- **数据标签**: 14px, medium, #374151
- **辅助文字**: 12px, regular, #6B7280

#### 6.2.3 间距规范
- **卡片间距**: 16px
- **图表间距**: 24px
- **内容边距**: 16px
- **元素间距**: 8px

### 6.3 动画效果设计
- **卡片加载**: 从左到右渐入动画，持续600ms
- **图表加载**: 从左到右渐入动画，持续800ms
- **数据更新**: 平滑过渡动画，持续500ms
- **交互反馈**: 悬停缩放效果，持续200ms

---

## 7. 开发计划

### 7.1 开发阶段划分

#### 7.1.1 第一阶段：核心指标与分配概览（1周）
- **任务**: 实现8个核心指标卡片和分配情况概览
- **交付物**: 指标仪表盘和分配概览功能
- **验收标准**: 
  - 8个指标正确显示计算数据
  - 分配情况根据模式动态调整
  - 响应式设计完成

#### 7.1.2 第二阶段：基础图表（1周）
- **任务**: 实现现金流回收图和分配图
- **交付物**: 基础图表功能
- **验收标准**: 
  - 图表正确显示计算数据
  - 基础交互功能正常
  - 移动端适配完成

#### 7.1.3 第三阶段：高级图表（0.5周）
- **任务**: 实现饼图和趋势图
- **交付物**: 高级图表功能
- **验收标准**: 
  - 饼图正确显示分配比例
  - 趋势图支持多指标展示
  - 交互体验良好

#### 7.1.4 第四阶段：优化完善（0.5周）
- **任务**: 性能优化和细节完善
- **交付物**: 完整可视化模块
- **验收标准**: 
  - 性能测试通过
  - 兼容性测试通过
  - 用户体验验收通过

### 7.2 技术风险评估
- **数据适配复杂度**: 中等风险，需要处理5种不同的计算模式
- **图表库学习成本**: 中等风险，预计需要1-2天学习
- **响应式布局**: 低风险，基于现有设计系统
- **性能优化**: 低风险，数据量相对较小

---

## 8. 测试计划

### 8.1 功能测试
- **指标显示测试**: 验证8个核心指标在各种计算模式下的正确性
- **分配概览测试**: 验证分配情况根据模式正确调整
- **图表渲染测试**: 验证各种计算模式下图表正确性
- **交互功能测试**: 验证鼠标和触摸交互
- **数据准确性测试**: 对比图表数据与计算结果

### 8.2 性能测试
- **加载性能**: 页面加载时间 < 3秒
- **渲染性能**: 图表渲染时间 < 1秒
- **内存占用**: 控制在合理范围内

### 8.3 兼容性测试
- **浏览器兼容**: Chrome, Firefox, Safari, Edge
- **设备兼容**: 桌面端、平板、手机
- **分辨率适配**: 1920x1080, 1366x768, 375x667等

---

## 9. 上线计划

### 9.1 上线前准备
- **代码审查**: 前端代码quality gate通过
- **功能验收**: 产品经理验收通过
- **性能测试**: 性能指标达标
- **文档更新**: 用户手册和技术文档更新

### 9.2 上线策略
- **灰度发布**: 先对内部用户开放，收集反馈
- **正式发布**: 功能稳定后全量发布
- **版本标记**: 更新版本号至v2.7.0

### 9.3 上线后监控
- **用户反馈**: 收集用户使用反馈
- **性能监控**: 监控图表加载和渲染性能
- **错误监控**: 及时发现和修复问题

---

## 10. 成功度量

### 10.1 量化指标
- **用户体验**: 页面加载时间 < 3秒，图表渲染时间 < 1秒
- **功能完整性**: 覆盖100%的计算模式和指标
- **兼容性**: 支持95%以上主流浏览器
- **错误率**: 图表渲染错误率 < 1%

### 10.2 定性指标
- **用户满意度**: 通过用户调研收集反馈
- **易用性**: 用户能够快速理解图表和指标含义
- **专业性**: 图表符合金融行业标准
- **一致性**: 与系统整体风格保持一致

---

## 11. 风险评估与应对

### 11.1 技术风险
- **风险**: 多种计算模式的数据适配复杂
- **应对**: 建立统一的数据转换接口，分模式测试

- **风险**: 图表库性能问题
- **应对**: 选择轻量级图表库，必要时切换方案

### 11.2 产品风险
- **风险**: 用户对分配概览理解困难
- **应对**: 提供清晰的标签说明和操作引导

- **风险**: 不同模式展示差异过大
- **应对**: 保持展示逻辑一致性，统一交互模式

### 11.3 项目风险
- **风险**: 开发周期延期
- **应对**: 合理规划优先级，核心功能优先

---

## 12. 后续规划

### 12.1 功能增强
- **对比分析**: 支持多情景对比
- **数据导出**: 图表导出为图片/PDF
- **个性化设置**: 用户自定义图表样式
- **报告生成**: 自动生成包含图表的分析报告

### 12.2 技术优化
- **性能优化**: 大数据量渲染优化
- **交互增强**: 更丰富的图表交互
- **移动端优化**: 针对移动端的特殊优化

---

## 附录

### A. 参考资料
- Chart.js官方文档
- 金融行业图表设计规范
- 现有系统UI设计规范

### B. 名词解释
- **IRR**: 内部收益率
- **DPI**: 分配倍数
- **Carry**: 管理人超额收益分成
- **门槛收益率**: 投资人的最低预期收益率

---

*文档版本: v1.1.0*  
*最后更新: 2024-12-19* 